---
id: 0b021e2a-b94c-4dbe-a09e-1a2d9d3b8e61
title: Wire specialist task delegation and execution timeline
parent: spec
created: "2026-02-16T23:23:02.539Z"
task:
  status: complete
  peerOrder: 300
  startedAt: "2026-02-16T23:45:54.444Z"
  assignedAgentIds: [agent-6a4d6273-5191-4698-891a-6e4cdde95479, agent-7a16cc85-7b41-47aa-9a05-0d08ad30c5e0]
  completedAt: "2026-02-16T23:50:14.212Z"
---

# Wire specialist task delegation and execution timeline

Enable orchestrator runs to create/delegate specialist tasks (Implement, Verify, Debug) and display execution status timeline entries.

## Scope
In scope: task creation/delegation wiring, specialist type mapping, timeline/status rendering for delegated task states.
Out of scope: provider-auth runtime work, GitHub PR submission, context-engine adapter integrations.

## Inputs
- [Spec](intent://local/note/spec)
- [Ship orchestrator planning loop and specialist task delegation](intent://local/task/55f46e5e-e243-4efc-971b-fd5cd1504a85)
- [Re-run Wave 1.6 gate and issue GO/NO-GO](intent://local/task/1665fe08-0270-4fd0-b48a-f33372a3970b)

## Definition of Done
- Orchestrator can delegate at least Implement, Verify, and Debug specialist tasks.
- Timeline shows per-task status transitions and terminal state.
- Delegation failures return actionable errors and leave run in consistent state.

## Verification
- `pnpm run desktop:typecheck`
- `pnpm test -- orchestrator`
- `pnpm test -- space`

## Summary (Turn 1)
Implemented deterministic specialist delegation wiring from orchestrator runs, including Implement/Verify/Debug specialist mapping and per-task timeline state transitions through terminal states. Added actionable delegation-failure handling that marks run/task states consistently and renders outcomes in the Orchestrator status card.

## Acceptance Criteria
- ✅ Orchestrator delegates Implement, Verify, and Debug task types via explicit mapping (`implementor`, `verifier`, `developer`).
- ✅ Timeline renders per-task status transitions and terminal state in Orchestrator status UI.
- ✅ Delegation failures surface actionable errors and keep run state consistent (`failed` terminal + deterministic skip/failure handling).

## Changes
- `src/main.tsx`: wired delegated-task timeline generation into orchestrator run completion; added status UI rendering for delegated tasks and terminal/error states.
- `src/shared/state.ts`: added delegated-task run model/types + normalization guards for persisted run/task timeline data.
- `src/shared/orchestrator-delegation.ts`: added specialist mapping and deterministic delegation timeline builder with failure handling.
- `src/shared/orchestrator-delegation.test.ts`: added tests for mapping, successful terminal timelines, and delegation-failure behavior.
- `src/shared/orchestrator-state.test.ts`: extended normalization assertions for delegated task terminal statuses.
- `src/shared/state.test.ts`: extended normalization coverage for valid delegated-task records and invalid delegated-task filtering.

## Verification
- `pnpm run desktop:typecheck` → PASS (exit 0)
- `pnpm test -- orchestrator` → PASS (16 files, 47 tests)
  - Evidence: includes `src/shared/orchestrator-delegation.test.ts` passing.
- `pnpm test -- space` → PASS (16 files, 47 tests)

## DoD Mapping
1. Orchestrator delegation for Implement/Verify/Debug: satisfied via `ORCHESTRATOR_SPECIALIST_BY_TASK_TYPE` and per-run delegation generation.
2. Timeline per-task transitions + terminal state: satisfied via `statusTimeline` and rendered delegated-task list in Orchestrator status card.
3. Actionable failure + consistent run state: satisfied via deterministic failure messages, failed terminal states on impacted tasks, and failed run status on delegation failure.

## Residual Risks
- Delegation execution is deterministic/local simulation (no external agent runtime dispatch yet), so runtime/provider-backed delegation behavior is not covered in this task scope.
- Existing test stderr warnings (`ReactDOMTestUtils.act` deprecation) remain pre-existing and non-blocking.

## Verifier Report (Turn 2)

### Verification Summary
- Verdict: **GO**
- Confidence: **High**
- Scope checked: Wave 2.1 Task 3 only (`Wire specialist task delegation and execution timeline`).

### Severity-Ranked Findings
- **P0:** None.
- **P1:** None.
- **P2:** None blocking DoD. Existing `ReactDOMTestUtils.act` deprecation warnings observed in unrelated test files during runs.

### DoD Checklist (Evidence-based)
1. **Orchestrator can delegate Implement/Verify/Debug specialist tasks** — ✅ VERIFIED
   - Evidence:
     - Specialist mapping is explicit in `src/shared/orchestrator-delegation.ts` (`implement -> implementor`, `verify -> verifier`, `debug -> developer`).
     - Delegated task records are generated for all three task types in `buildDelegatedTaskTimeline`.
     - `onRunOrchestrator` persists delegated task outcomes into run state via `delegatedTasks` in `src/main.tsx`.
   - Verification:
     - `src/shared/orchestrator-delegation.test.ts` validates all three mappings and multi-task outcomes.
     - `pnpm test -- orchestrator` PASS.

2. **Timeline shows per-task status transitions and terminal states** — ✅ VERIFIED
   - Evidence:
     - Per-task `statusTimeline` transitions are built in `src/shared/orchestrator-delegation.ts` (`queued -> delegating -> delegated -> running -> completed` or `failed`).
     - Timeline and terminal statuses are rendered in orchestrator status UI in `src/main.tsx` (`Lifecycle` and delegated task list with status timelines).
     - State model supports run/task lifecycle persistence in `src/shared/state.ts` (`OrchestratorRunStatus`, `OrchestratorTaskStatus`, `delegatedTasks`).
   - Verification:
     - `src/shared/orchestrator-delegation.test.ts` asserts complete transition path.
     - `src/shared/orchestrator-state.test.ts` / `src/shared/state.test.ts` assert normalization/persistence of terminal lifecycle records.
     - `pnpm test -- orchestrator` and `pnpm test -- space` PASS.

3. **Delegation failures are actionable and keep run state consistent** — ✅ VERIFIED
   - Evidence:
     - Actionable failure messages are produced in `resolveDelegationFailure` (retry guidance included).
     - On delegation failure, failed task terminal state and skip-reason propagation are enforced in `buildDelegatedTaskTimeline`.
     - Run terminal state becomes `failed` with `errorMessage`, and final state is persisted in `onRunOrchestrator` (`src/main.tsx`).
   - Verification:
     - `src/shared/orchestrator-delegation.test.ts` validates failure message text, failed task status, and downstream skip behavior.
     - `pnpm test -- orchestrator` PASS.

### Out-of-Scope Audit
- Checked task-relevant code paths (`src/main.tsx`, `src/shared/orchestrator-delegation.ts`, `src/shared/state.ts`, related tests).
- No provider auth/runtime, GitHub PR submission flow wiring, context-engine adapter integration, or browser-preview behavior was introduced in these Task 3 paths.

### Commands Run
- `pnpm run desktop:typecheck` → PASS
- `pnpm test -- orchestrator` → PASS
- `pnpm test -- space` → PASS

### GO/NO-GO Decision
- **GO** for Wave 2.1 Task 3 based on passing required commands and direct code/test evidence for all DoD outcomes.