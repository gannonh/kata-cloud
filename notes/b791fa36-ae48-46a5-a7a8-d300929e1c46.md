---
id: b791fa36-ae48-46a5-a7a8-d300929e1c46
title: Clarify draft-apply behavior in spec panel UX
parent: spec
created: "2026-02-17T00:18:35.300Z"
task:
  status: complete
  peerOrder: 300
  startedAt: "2026-02-17T01:06:42.533Z"
  assignedAgentIds: [agent-047e74e5-b121-435d-9eb5-d6ca1abe744b, agent-1ce70fcb-902e-4e25-b8c7-7b7d5436d4fa]
  completedAt: "2026-02-17T01:08:50.487Z"
---

# Clarify draft-apply behavior in spec panel UX

Make it explicit in the UI when a draft has been generated but not yet applied, so users understand why spec markdown has not changed.

## Scope
In scope: spec-panel/orchestrator UX messaging and status indicators around draft readiness/applied state.
Out of scope: auto-apply behavior changes unless explicitly approved as follow-up.

## Inputs
- [Spec](intent://local/note/spec)
- [Implement spec-draft synthesis from orchestrator runs](intent://local/task/5eda575f-6be5-4c03-a27f-ae1ca6b2b797)

## Definition of Done
- UI clearly distinguishes `draft generated` vs `draft applied` states.
- User can see explicit guidance that spec markdown changes only after apply.
- Applied state includes clear confirmation (timestamp or equivalent).

## Verification
- `pnpm run desktop:typecheck`
- `pnpm test -- notes`
- `pnpm test -- orchestrator`
- Manual: run prompt, confirm draft-generated state, apply draft, confirm applied state

## Summary (Turn 1)
Implementing scoped UX clarification for orchestrator draft lifecycle in spec panel: make `draft generated` vs `draft applied` explicit, state that spec markdown updates only after apply, and preserve visible applied confirmation.

## Acceptance Criteria
- [ ] Draft-present UI explicitly indicates draft is generated but not yet applied.
- [ ] UI guidance explicitly states spec markdown remains unchanged until apply action.
- [ ] Successful apply state shows explicit confirmation signal (existing timestamp/message acceptable).
- [ ] Required verification commands are run and results captured.

## Subtasks
- None.

## References
- `src/features/spec-panel/spec-note-panel.tsx`
- `src/features/spec-panel/spec-note-panel.test.tsx`
- `src/main.tsx` (status panel display only, if needed)

## Learnings
- Keep this task isolated from run-history persistence and failure-path logic to minimize merge conflicts.

## Changes
- Pending implementation edits.

## Summary (Turn 2)
Completed scoped UX clarification in spec panel draft card. UI now explicitly shows `generated (not applied)` before apply, states that markdown updates only after apply, and shows a clearer applied confirmation including time.

## Changes
- `src/features/spec-panel/spec-note-panel.tsx`
  - Added explicit draft lifecycle status copy in Orchestrator Draft card:
    - `Draft status: generated (not applied).`
    - `Draft status: applied.`
  - Added user guidance copy: `Spec Markdown updates only after you click Apply Draft to Spec.` (visible while pending apply).
  - Updated apply success message to include confirmation time: `Applied draft from run <id> at <local time>.`
- `src/features/spec-panel/spec-note-panel.test.tsx`
  - Added assertions for pending-draft status and explicit pre-apply markdown guidance.
  - Added assertion for applied confirmation message including `at` timestamp text.

## Verification Results
- `pnpm run desktop:typecheck` -> PASS (exit 0).
- `pnpm test -- notes` -> PASS.
  - Evidence: `Test Files 17 passed (17)`, `Tests 52 passed (52)`.
- `pnpm test -- orchestrator` -> PASS.
  - Evidence: `Test Files 17 passed (17)`, `Tests 52 passed (52)`.
- Observed non-blocking warning during tests: `ReactDOMTestUtils.act` deprecation warning in existing test setup.

## DoD Mapping
- `UI clearly distinguishes draft generated vs draft applied states.` -> PASS via explicit `Draft status: generated (not applied).` and `Draft status: applied.` state text in `src/features/spec-panel/spec-note-panel.tsx`.
- `User can see explicit guidance that spec markdown changes only after apply.` -> PASS via explicit guidance sentence rendered while draft is pending apply.
- `Applied state includes clear confirmation (timestamp or equivalent).` -> PASS via applied success message including confirmation time (`... at <local time>.`).

## Residual Risks
- Confirmation timestamp uses client-local `toLocaleString()` formatting, so exact visual format varies by locale/timezone.
- Existing non-blocking `act` deprecation warnings remain in tests (unchanged by this task).

## Verification Summary (Turn 3 - Verifier, 2026-02-17)

### Verdict
- **GO** (Confidence: **High**)

### Severity-Ranked Findings
- **P0:** None.
- **P1:** None.
- **P2:** None (non-blocking existing warning only: `ReactDOMTestUtils.act` deprecation during tests).

### Acceptance Criteria Checklist
- ✅ `UI clearly distinguishes draft generated vs draft applied states.`
  - Evidence: `src/features/spec-panel/spec-note-panel.tsx:232` renders `Draft status: generated (not applied).` when pending and `Draft status: applied.` after apply.
  - Verification: Static review + `pnpm test -- notes` PASS with assertions in `src/features/spec-panel/spec-note-panel.test.tsx:137` and `src/features/spec-panel/spec-note-panel.test.tsx:145`.

- ✅ `User can see explicit guidance that spec markdown changes only after apply.`
  - Evidence: `src/features/spec-panel/spec-note-panel.tsx:234` renders `Spec Markdown updates only after you click Apply Draft to Spec.` while draft is not applied.
  - Verification: Static review + test assertion in `src/features/spec-panel/spec-note-panel.test.tsx:138`.

- ✅ `Applied state includes clear confirmation (timestamp or equivalent).`
  - Evidence: apply status message now includes time at `src/features/spec-panel/spec-note-panel.tsx:138` (`Applied draft from run ... at ...`).
  - Verification: Static review + regex assertion for timestamped applied message in `src/features/spec-panel/spec-note-panel.test.tsx:145`.

### Out-of-Scope Guard Check
- ✅ No out-of-scope behavior changes observed.
- Evidence: `git diff --name-only` shows only:
  - `src/features/spec-panel/spec-note-panel.tsx`
  - `src/features/spec-panel/spec-note-panel.test.tsx`
- No edits found for provider/auth runtime, PR/browser/context-adapter work, or auto-apply behavior.

### Commands Run
- `pnpm run desktop:typecheck` → PASS
- `pnpm test -- notes` → PASS
- `pnpm test -- orchestrator` → PASS

### Risk Notes
- Applied confirmation timestamp uses locale-dependent formatting (`toLocaleString()`), so exact display format varies by user locale/timezone (non-blocking).