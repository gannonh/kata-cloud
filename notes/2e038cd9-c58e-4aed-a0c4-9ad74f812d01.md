---
id: 2e038cd9-c58e-4aed-a0c4-9ad74f812d01
title: Fix GitCli mock typing mismatches in tests
parent: spec
created: "2026-02-16T19:49:10.347Z"
task:
  status: complete
  peerOrder: 200
  startedAt: "2026-02-16T19:53:24.644Z"
  assignedAgentIds: [agent-9fb13fe1-047a-45f2-93df-cda8adcac365]
  completedAt: "2026-02-16T19:55:18.162Z"
---

# Fix GitCli mock typing mismatches in tests

Correct test doubles so strict typing no longer fails with `TS2739` in git service tests.

## Scope
In scope: `src/git/space-git-service.node.test.ts`, `src/git/space-git-service.test.ts`, and minimal local test helper/type updates needed.
Out of scope: production git behavior changes.

## Inputs
- [Spec](intent://local/note/spec)
- [Wave 1.5 final verifier](intent://local/task/e7be8fb9-0d21-4a8b-9cfd-0ad2686a3f77)

## Definition of Done
- `TS2739` mock/type mismatch errors are removed.
- Test behavior assertions remain intact.
- Task note includes before/after typecheck evidence.

## Verification
- `pnpm run desktop:typecheck`
- `pnpm run test -- git`


## Summary (Turn 1)
Preparing minimal test-only typing fixes for GitCli mock TS2739 errors in the two scoped git service test files.

## Acceptance Criteria
- [x] `pnpm run desktop:typecheck` no longer reports TS2739 mismatches for GitCli mocks in scoped git service tests.
- [x] `pnpm run test -- git` passes after the typing fixes.
- [x] Only test-side typing updates are made in scope files.
- [x] Task note includes exact file diff and before/after command evidence.

## References
- `src/git/space-git-service.node.test.ts`
- `src/git/space-git-service.test.ts`

## Learnings
- `GitCli` is a class with private members, so plain object mocks no longer structurally satisfy `GitCli`; test helpers need an explicit cast for mock objects.

## Changes
- `src/git/space-git-service.node.test.ts`: imported `type GitCli`, changed `createFakeGit` return type to `GitCli`, and cast helper return object as `unknown as GitCli`.
- `src/git/space-git-service.test.ts`: imported `type GitCli`, changed `createFakeGit` return type to `GitCli`, and cast helper return object as `unknown as GitCli`.


## Summary (Turn 2)
Implemented minimal test-only typing updates for `GitCli` mocks in the two scoped test files. No production git files were changed.

## Verification Evidence

### Before
- `pnpm run desktop:typecheck` (exit 2)
  - `src/git/space-git-service.node.test.ts(43,5): error TS2739 ... missing ... commandRunner, assertSuccess`
  - `src/git/space-git-service.node.test.ts(68,5): error TS2739 ... missing ... commandRunner, assertSuccess`
  - `src/git/space-git-service.test.ts(62,7): error TS2739 ... missing ... commandRunner, assertSuccess`
  - `src/git/space-git-service.test.ts(93,7): error TS2739 ... missing ... commandRunner, assertSuccess`
  - `src/git/space-git-service.test.ts(107,7): error TS2739 ... missing ... commandRunner, assertSuccess`
  - `src/git/space-git-service.test.ts(126,7): error TS2739 ... missing ... commandRunner, assertSuccess`
- `pnpm run test -- git` (exit 0)

### After
- `pnpm run desktop:typecheck` (exit 0)
- `pnpm run test -- git` (exit 0)

## Exact File Diff
```diff
diff --git a/src/git/space-git-service.node.test.ts b/src/git/space-git-service.node.test.ts
index 9cdd973..7b91ba8 100644
--- a/src/git/space-git-service.node.test.ts
+++ b/src/git/space-git-service.node.test.ts
@@ -1,9 +1,10 @@
 import assert from "node:assert/strict";
 import { test } from "vitest";
+import type { GitCli } from "./git-cli";
 import { SpaceGitLifecycleService } from "./space-git-service";
 import { createSpaceGitRequest } from "./types";
 
-function createFakeGit(overrides = {}) {
+function createFakeGit(overrides = {}): GitCli {
   return {
@@ -24,7 +25,7 @@ function createFakeGit(overrides = {}) {
       return "kata-space/feature-space1";
     },
     ...overrides
-  };
+  } as unknown as GitCli;
 }
 
 function createRequest() {
diff --git a/src/git/space-git-service.test.ts b/src/git/space-git-service.test.ts
index 129102f..7e2fca1 100644
--- a/src/git/space-git-service.test.ts
+++ b/src/git/space-git-service.test.ts
@@ -1,4 +1,5 @@
 import { describe, expect, it } from "vitest";
+import type { GitCli } from "./git-cli";
 import { SpaceGitLifecycleService } from "./space-git-service";
 import {
   createSpaceGitRequest,
@@ -20,7 +21,7 @@ function createFakeGit(
     switchBranch: (worktreePath: string, branchName: string) => Promise<void>;
     currentBranch: (worktreePath: string) => Promise<string>;
   }> = {}
-) {
+) : GitCli {
   return {
@@ -41,7 +42,7 @@ function createFakeGit(
       return "kata-space/feature-1234";
     },
     ...overrides
-  };
+  } as unknown as GitCli;
 }
 
 function createBaseRequest(): SpaceGitLifecycleRequest {
```