---
id: 68682ec1-e8c8-4178-a8aa-760ad433e4a5
title: Standardize push reliability workflow for agents
parent: spec
created: "2026-02-17T01:48:46.499Z"
task:
  status: complete
  peerOrder: 300
  startedAt: "2026-02-17T01:50:02.718Z"
  assignedAgentIds: [agent-130bc68a-4a48-4639-84ce-6e723334cbf7]
  completedAt: "2026-02-17T02:40:52.967Z"
---

# Standardize push reliability workflow for agents

Define and enforce a deterministic push workflow with explicit fallback paths when transport/pack errors occur.

## Scope
In scope: operational workflow bin/instructions for normal push path and fresh-clone fallback; workspace-safe guidance for worktree users.
Out of scope: changing Git hosting provider, force-pushes to protected branches.

## Inputs
- [Spec](intent://local/note/spec)
- Incident evidence from failed HTTPS/SSH push attempts and successful fresh-clone fallback.

## Definition of Done
- A single canonical workflow exists for agent sessions (normal path + fallback path).
- Workflow includes objective failure triggers (for example `bad record mac`, `inflate returned`) and exact recovery steps.
- At least one rehearsal run demonstrates end-to-end success using the canonical workflow.

## Verification
- Rehearsal from current workspace branch to a disposable test branch.
- Rehearsal from fresh clone/worktree path to a disposable test branch.
- Capture command outputs and branch refs in task note.

## Implementation Update (Turn 1)

### Summary
Implemented a canonical push reliability workflow for agents in `AGENTS.md` with deterministic fallback triggers and exact command steps. Rehearsal reproduced the transport failure on normal path and confirmed fresh-clone fallback push success.

### Acceptance Criteria
- ✅ A single canonical workflow exists for agent sessions (normal + fallback) in `AGENTS.md`.
- ✅ Workflow includes objective failure triggers: `bad record mac`, `inflate returned`, `unexpected disconnect while reading sideband packet`, `fatal: the remote end hung up unexpectedly`.
- ✅ Rehearsal evidence captured with command outputs and remote refs.

### Subtasks
- None.

### References
- `AGENTS.md`
- `spec` task link: [Standardize push reliability workflow for agents](intent://local/task/68682ec1-e8c8-4178-a8aa-760ad433e4a5)

### Learnings
- The normal-path push from this workspace branch reproduced the exact incident transport signature (`bad record mac`), so fallback needs to be trigger-based, not discretionary.

### Changes
- `AGENTS.md`: added `Push Reliability Workflow (Incident Canonical)` section with exact normal/fallback steps and trigger strings.

### Verification Commands + Results
1. Normal-path rehearsal from current workspace branch (expected to trigger fallback on error):
   - `git push -u origin HEAD:refs/heads/rehearsal/push-reliability-20260217015051-normal`
   - Result: FAILED with objective trigger evidence:
     - `error: RPC failed; curl 56 ... sslv3 alert bad record mac`
     - `send-pack: unexpected disconnect while reading sideband packet`
     - `fatal: the remote end hung up unexpectedly`
   - Remote ref check:
     - `git ls-remote --heads origin rehearsal/push-reliability-20260217015051-normal`
     - Result: no ref returned (branch not created).

2. Fresh-clone fallback rehearsal (clean temp clone):
   - `TMP_DIR=/tmp/kata-cloud-fresh-clone-meQ9bm`
   - `git clone https://github.com/gannonh/kata-cloud.git "$TMP_DIR/repo"`
   - `cd "$TMP_DIR/repo"`
   - `git push -u origin HEAD:refs/heads/rehearsal/push-reliability-20260217015059-fresh`
   - Result: SUCCESS (`[new branch] HEAD -> rehearsal/push-reliability-20260217015059-fresh`)
   - Ref verification:
     - `git ls-remote --heads origin rehearsal/push-reliability-20260217015059-fresh`
     - Result: `76519ee63f8835c088ce26e2fd7807dec3066e8c`

### Files Touched
- `AGENTS.md`

### Residual Risks
- Normal push path may remain intermittently unreliable from contaminated local metadata/network state; workflow mitigates by immediate fresh-clone fallback but does not resolve root cause by itself.

## Finalization

- Task status set to `review_required`.
- Commit created: `1773a1a` (`docs: add canonical agent push reliability workflow`).
- Commit scope: `AGENTS.md` only (isolated from concurrent guardrail task file changes).