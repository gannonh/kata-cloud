---
id: 51039010-2109-4c7f-9a24-5cf0f968f5eb
title: Re-establish Git hygiene and branch/worktree cleanup
parent: spec
created: "2026-02-17T02:57:41.043Z"
task:
  status: complete
  peerOrder: 200
  completedAt: "2026-02-17T03:47:24.174Z"
---

# Re-establish Git hygiene and branch/worktree cleanup

Ensure the recovered branch is pushable and remove stale local/remote codex-session artifacts safely.

## Scope
In scope: health checks, push verification, cleanup of explicitly approved stale branches/worktrees.
Out of scope: rewriting `main` history or deleting non-session branches.

## Inputs
- [Spec](intent://local/note/spec)
- Recovery task output
- Approved stale patterns: `codex/*`, `git-stability-incident`, `unblock-wave-1-verification` (confirm?)

## Definition of Done
- `git fsck --full` has no invalid-ref errors.
- `git count-objects -vH` reports `garbage: 0`.
- `git worktree list --porcelain` shows only active worktrees.
- Push from recovered branch succeeds via canonical workflow.
- Stale branch/worktree cleanup evidence is logged.

## Verification
- `git fsck --full`
- `git count-objects -vH`
- `git worktree list --porcelain`
- `git push -u origin HEAD`
- `git branch --format='%(refname:short)'`
- `git branch -r --format='%(refname:short)'`

## Verification Update (2026-02-17)

1. Health checks currently pass on active workspace: `git fsck --full` clean for invalid refs; `git count-objects -vH` shows `garbage: 0`; worktree inventory is stable.
2. Remote cleanup progress: stale `origin/codex/*` branches used during incident were deleted successfully.
3. Push-path risk remains for large historical object sets: repeated direct pushes failed with `bad record mac`, `inflate returned -5`, and `inflate returned -3`/`remote unpack failed`.
4. Operational mitigation worked: a fresh-clone publish path produced `origin/feature/run-history-persistence` at `be71982`.
5. Decision: keep this task in review state until we complete one normal-sized feature commit push on the resumed branch to confirm day-to-day push reliability in current environment.

## Branch Rule Finding (2026-02-17)

Attempted `git push origin main` after local fast-forward merge from `feature/run-history-persistence` was rejected with repository rule `GH013` (changes to `main` must be via pull request). Cleanup/hygiene remains valid; final closeout condition for this task is now: successful PR merge to `main` and post-merge local sync.

## Current Gate (2026-02-17)

PR opened to satisfy protected-branch integration: https://github.com/gannonh/kata-cloud/pull/2 (`feature/run-history-persistence` -> `main`).
This task can move to complete after PR #2 is merged and local sync to `origin/main` is confirmed.