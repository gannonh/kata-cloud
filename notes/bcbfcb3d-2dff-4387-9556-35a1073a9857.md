---
id: bcbfcb3d-2dff-4387-9556-35a1073a9857
title: Implement space creation and metadata management
parent: spec
created: "2026-02-16T13:58:41.791Z"
task:
  status: review_required
  peerOrder: 200
  assignedAgentIds: [agent-bdcb8907-cb6d-41c9-b052-087274438ebf]
  startedAt: "2026-02-16T14:10:43.052Z"
---

# Implement space creation and metadata management

Add the Create Space flow with user inputs and persistent metadata.

## Scope
Create UI/form for space name, path, optional repo link, description, and tags. Implement create/edit metadata behavior, persistence usage, and validation on top of bootstrap-owned shell/state contracts. Excludes shell scaffolding/state-core refactors and excludes git worktree/branch lifecycle creation.

## Inputs
`docs/kata-cloud-ovweview.md` section "Spaces"
`[Spec](intent://local/note/spec)`

## Definition of Done
- User can create a space from prompt-driven workflow.
- Space metadata (name/path/description/tags/repo) persists and rehydrates on app relaunch.
- Validation prevents invalid or duplicate space names in the same workspace root.

## Verification
- `pnpm run test -- space`
- Manual: create/edit/reopen multiple spaces

## Work Log

### Summary (Turn 1)
Reviewed spec + task scope and confirmed this task only covers Create Space UI/form + metadata persistence/rehydration + validation for invalid/duplicate names under same workspace root. Beginning targeted code discovery before implementation.

### Acceptance Criteria
- [ ] Create Space workflow collects `name`, `path`, optional `repo`, optional `description`, and `tags`.
- [ ] Space metadata persists to local storage/database and rehydrates on app restart.
- [ ] Validation rejects invalid names and duplicate names within the same workspace root.
- [ ] Existing tests for space behavior pass or are updated minimally for the new flow.

### Subtasks
- [ ] None delegated (single-agent implementation).

### References
- `docs/kata-cloud-ovweview.md` (Spaces section)
- `spec` note task + acceptance criteria

### Learnings
- None yet.

### Changes
- None yet.

### Summary (Turn 2)
Implemented a prompt-driven Create Space workflow component with metadata fields (`name`, `path`, optional `repo`, optional `description`, `tags`), storage persistence/rehydration, and duplicate/invalid-name validation scoped to workspace root. Removed cross-task git lifecycle coupling from `src/space/*` to keep this task focused on metadata management.

### Acceptance Criteria
- [x] Create Space workflow collects `name`, `path`, optional `repo`, optional `description`, and `tags`.
- [x] Space metadata persists to local storage/database and rehydrates on app restart.
- [x] Validation rejects invalid names and duplicate names within the same workspace root.
- [ ] Existing tests for space behavior pass or are updated minimally for the new flow. (Tests were updated, but execution is blocked by offline dependency install.)

### Verification Run
- `pnpm run test -- space` -> **failed**: `sh: vitest: command not found` (no `node_modules` present)
- `pnpm install` -> **failed**: `ENOTFOUND registry.npmjs.org` (offline/network-restricted environment)
- Attempted escalated `pnpm install` twice; both approval prompts were interrupted before completion.

### Learnings
- Parallel task work introduced git lifecycle code into some shared files. To stay within scope, this task's finalized changes remain centered on `src/space/*` metadata creation/persistence/validation behavior.

### Changes
- `src/space/types.ts`
- `src/space/validation.ts`
- `src/space/store.ts`
- `src/space/create-space-flow.tsx`
- `src/space/validation.test.ts`
- `src/space/store.test.ts`
- `src/space/create-space-flow.test.tsx`
- `src/test/setup.ts`

### Summary (Turn 3)
Aligned to coordinator boundary by implementing create/edit metadata UI directly against bootstrap-owned state contracts in `src/main.tsx` while keeping validation/persistence behavior in scope. Create and edit now both enforce invalid/duplicate-name checks (same workspace root), and metadata updates persist via existing `persistState` flow.

### Additional Changes
- `src/main.tsx`
  - Added prompt-driven Create Space workflow UI and submit handler.
  - Added Edit Space Metadata UI + save handler for existing spaces.
  - Reused `validateCreateSpaceInput` for both create and edit (edit validates against other spaces only).
  - Persist/rehydrate uses existing bootstrap state save/restore pathway.
- `src/styles.css`
  - Added form styling hooks used by create/edit metadata sections.

### Verification Update
- Re-ran `pnpm run test -- space` after integration changes.
- Still blocked in this environment because dependencies are not installed (`vitest: command not found`) and dependency install cannot complete offline (`ENOTFOUND registry.npmjs.org`).

### Summary (Turn 4)
Applied a minimal fix for the Wave 1 gate blocker in space tests by updating the tags field query in `src/space/create-space-flow.test.tsx` to match current accessible-label behavior when helper text is nested inside the label.

### Changes (Turn 4)
- `src/space/create-space-flow.test.tsx`
  - Changed tags selector from exact string to regex: `getByLabelText(/Tags \(optional\)/i)`.

### Verification (Turn 4)
- `pnpm run test -- space`
  - `src/space/create-space-flow.test.tsx` now passes (both tests passing).
  - Command still exits non-zero due existing unrelated suites:
    - `src/git/space-git-service.node.test.ts` -> `No test suite found in file`
    - `src/git/types.node.test.ts` -> `No test suite found in file`
- `pnpm run test -- notes`
  - Space test remains passing.
  - Command still exits non-zero for the same two existing `.node.test.ts` suites above.

### Risk / Follow-up
- The requested `Tags (optional)` test failure is resolved.
- Wave 1 scoped commands still cannot run fully clean until `.node.test.ts` suite-selection behavior is addressed outside this task scope.