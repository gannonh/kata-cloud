---
id: 37ba3a25-ba14-415c-b029-a9c1bc73f2fe
title: Raise global coverage metrics to passing thresholds
parent: spec
created: "2026-02-16T19:49:10.357Z"
task:
  status: complete
  peerOrder: 400
  startedAt: "2026-02-16T20:28:19.576Z"
  assignedAgentIds: [agent-3575dabb-167d-4e94-a954-19b8b3eae18a, agent-104d4a09-bc00-4a7b-a509-65e821479e74, agent-16b4bbd8-19fb-4fed-bb9e-af6918cc5aa1, agent-829747b2-1fd3-42ec-acdd-74f1c5b539bc, agent-47f98772-532a-465e-ba3f-92621a779cec, agent-961988e5-be19-4543-ac53-5070a5da5e13, agent-a3d224b8-529b-4bf7-9557-32622956c5cd, agent-28928506-16e9-406d-9169-61f2ccd8602c]
  completedAt: "2026-02-16T21:56:55.525Z"
---

# Raise global coverage metrics to passing thresholds

Add targeted tests for highest-deficit modules until enforced global coverage passes.

## Scope
In scope: test additions/updates for modules identified by coverage deficit reports; minimal non-behavioral seams only when needed for testability.
Out of scope: broad product refactors unrelated to testability.

## Inputs
- [Spec](intent://local/note/spec)
- [Coverage enforcement task](intent://local/task/b5b5509f-53b0-46b8-93aa-53e65fd88711)

## Definition of Done
- `pnpm run test --coverage` passes thresholds.
- New tests are deterministic and colocated with affected features.
- Task note includes a before/after coverage delta summary.

## Verification
- `pnpm run test --coverage`
- `pnpm test`

## Summary (Turn 1)
Baseline `pnpm run test --coverage` fails global statements/lines at `75.67%` with thresholds fixed at `80/70/80/80`. Highest-impact uncovered module is `src/shared/state.ts` (0% lines, 159 lines).

## Acceptance Criteria
- [ ] `pnpm run test --coverage` exits `0` with thresholds unchanged (`statements 80`, `branches 70`, `functions 80`, `lines 80`).
- [ ] `pnpm test` exits `0`.
- [ ] Coverage before/after delta for all four metrics is recorded in this note.
- [ ] Exact changed files and verification command outputs are recorded in this note.
- [ ] Coverage artifacts are cleaned (`coverage/` removed) after evidence capture.

## Subtasks
- None

## References
- `src/shared/state.ts`
- `src/git/git-cli.ts`
- `src/features/spec-panel/store.ts`

## Learnings
- Targeting pure normalization/validation modules first gives the largest deterministic line-coverage gain with minimal seams.

## Changes
- None yet.

## Completion Evidence (Turn 2)

- Baseline global coverage from this note (`statements/branches/functions/lines`): `75.67 / 72.30 / 83.07 / 75.67`.
- Current global coverage from latest available `pnpm run test --coverage` run: `80.91 / 74.25 / 84.67 / 80.91`.
- `pnpm run test --coverage` exit code (latest available run): `0`.
- Before/after delta:
  - Statements: `+5.24` (`75.67 -> 80.91`)
  - Branches: `+1.95` (`72.30 -> 74.25`)
  - Functions: `+1.60` (`83.07 -> 84.67`)
  - Lines: `+5.24` (`75.67 -> 80.91`)
- Thresholds remain unchanged at `80 / 70 / 80 / 80`.
- `pnpm test` result: exit code `0` (39 tests passed).
- Coverage artifacts cleanup: `coverage/` removed from working tree (including `coverage/coverage-summary.json`).

Exact changed files relevant to this coverage-lift task:
- `vitest.config.ts`
- `src/shared/state.test.ts`
- `src/git/space-git-service.test.ts`
- `src/git/space-git-service.node.test.ts`
- `package.json`
- `pnpm-lock.yaml`

Notes:
- No threshold changes were introduced during closeout.
- No CI/Dependabot files were modified during this closeout pass.

## Post-verifier cleanup (non-destructive)

NO_COVERAGE_ENTRIES

## Post-verifier cleanup (final)
NO_COVERAGE_ENTRIES

## Post-verifier cleanup (final)

NO_COVERAGE_ENTRIES