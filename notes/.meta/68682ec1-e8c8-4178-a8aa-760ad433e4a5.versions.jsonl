{"type":"snapshot","v":1,"date":"2026-02-17T01:57:01.448Z","author":{"id":"user","name":"User","type":"user"},"content":"# Standardize push reliability workflow for agents\n\nDefine and enforce a deterministic push workflow with explicit fallback paths when transport/pack errors occur.\n\n## Scope\nIn scope: operational workflow bin/instructions for normal push path and fresh-clone fallback; workspace-safe guidance for worktree users.\nOut of scope: changing Git hosting provider, force-pushes to protected branches.\n\n## Inputs\n- [Spec](intent://local/note/spec)\n- Incident evidence from failed HTTPS/SSH push attempts and successful fresh-clone fallback.\n\n## Definition of Done\n- A single canonical workflow exists for agent sessions (normal path + fallback path).\n- Workflow includes objective failure triggers (for example `bad record mac`, `inflate returned`) and exact recovery steps.\n- At least one rehearsal run demonstrates end-to-end success using the canonical workflow.\n\n## Verification\n- Rehearsal from current workspace branch to a disposable test branch.\n- Rehearsal from fresh clone/worktree path to a disposable test branch.\n- Capture command outputs and branch refs in task note.\n\n## Implementation Update (Turn 1)\n\n### Summary\nImplemented a canonical push reliability workflow for agents in `AGENTS.md` with deterministic fallback triggers and exact command steps. Rehearsal reproduced the transport failure on normal path and confirmed fresh-clone fallback push success.\n\n### Acceptance Criteria\n- ✅ A single canonical workflow exists for agent sessions (normal + fallback) in `AGENTS.md`.\n- ✅ Workflow includes objective failure triggers: `bad record mac`, `inflate returned`, `unexpected disconnect while reading sideband packet`, `fatal: the remote end hung up unexpectedly`.\n- ✅ Rehearsal evidence captured with command outputs and remote refs.\n\n### Subtasks\n- None.\n\n### References\n- `AGENTS.md`\n- `spec` task link: [Standardize push reliability workflow for agents](intent://local/task/68682ec1-e8c8-4178-a8aa-760ad433e4a5)\n\n### Learnings\n- The normal-path push from this workspace branch reproduced the exact incident transport signature (`bad record mac`), so fallback needs to be trigger-based, not discretionary.\n\n### Changes\n- `AGENTS.md`: added `Push Reliability Workflow (Incident Canonical)` section with exact normal/fallback steps and trigger strings.\n\n### Verification Commands + Results\n1. Normal-path rehearsal from current workspace branch (expected to trigger fallback on error):\n   - `git push -u origin HEAD:refs/heads/rehearsal/push-reliability-20260217015051-normal`\n   - Result: FAILED with objective trigger evidence:\n     - `error: RPC failed; curl 56 ... sslv3 alert bad record mac`\n     - `send-pack: unexpected disconnect while reading sideband packet`\n     - `fatal: the remote end hung up unexpectedly`\n   - Remote ref check:\n     - `git ls-remote --heads origin rehearsal/push-reliability-20260217015051-normal`\n     - Result: no ref returned (branch not created).\n\n2. Fresh-clone fallback rehearsal (clean temp clone):\n   - `TMP_DIR=/tmp/kata-cloud-fresh-clone-meQ9bm`\n   - `git clone https://github.com/gannonh/kata-cloud.git \"$TMP_DIR/repo\"`\n   - `cd \"$TMP_DIR/repo\"`\n   - `git push -u origin HEAD:refs/heads/rehearsal/push-reliability-20260217015059-fresh`\n   - Result: SUCCESS (`[new branch] HEAD -> rehearsal/push-reliability-20260217015059-fresh`)\n   - Ref verification:\n     - `git ls-remote --heads origin rehearsal/push-reliability-20260217015059-fresh`\n     - Result: `76519ee63f8835c088ce26e2fd7807dec3066e8c`\n\n### Files Touched\n- `AGENTS.md`\n\n### Residual Risks\n- Normal push path may remain intermittently unreliable from contaminated local metadata/network state; workflow mitigates by immediate fresh-clone fallback but does not resolve root cause by itself.\n\n## Finalization\n\n- Task status set to `review_required`.\n- Commit created: `1773a1a` (`docs: add canonical agent push reliability workflow`).\n- Commit scope: `AGENTS.md` only (isolated from concurrent guardrail task file changes).","title":"Standardize push reliability workflow for agents"}
