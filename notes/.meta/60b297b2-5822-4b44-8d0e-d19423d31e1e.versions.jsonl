{"type":"snapshot","v":1,"date":"2026-02-16T20:32:15.893Z","author":{"id":"user","name":"User","type":"user"},"content":"# Define enforceable coverage scope and command path\n\nEnsure coverage gating executes deterministically and targets the intended code surface without lowering thresholds.\n\n## Scope\nIn scope: `vitest.config.ts` coverage include/exclude/reporter configuration and command-path alignment documentation.\nOut of scope: lowering thresholds below `80/70/80/80`.\n\n## Inputs\n- [Spec](intent://local/note/spec)\n- [Coverage enforcement task](intent://local/task/b5b5509f-53b0-46b8-93aa-53e65fd88711)\n- [Wave 1.5 final verifier](intent://local/task/e7be8fb9-0d21-4a8b-9cfd-0ad2686a3f77)\n\n## Definition of Done\n- Coverage runs via a single deterministic path used by local and CI gates.\n- Coverage scope rules are explicit and justified in the task note.\n- Threshold enforcement remains `statements 80`, `branches 70`, `functions 80`, `lines 80`.\n\n## Verification\n- `pnpm run test --coverage`\n- Inspect `vitest.config.ts` and `.github/workflows/ci-quality-gates.yml` for path/scope alignment\n\n## Completion Evidence (Turn 2)\n\n### Exact `vitest.config.ts` diff summary\nOnly `vitest.config.ts` was changed for this task.\n\n- Added `test.coverage` config block.\n- Set provider/report output path:\n  - `provider: \"v8\"`\n  - `reporter: [\"text\", \"json-summary\"]`\n  - `reportsDirectory: \"./coverage\"`\n- Added explicit deterministic scope:\n  - `include`: `src/**/*.{ts,tsx}`, `packages/task-parser/src/**/*.js`\n  - `exclude`: `src/main.tsx`, `src/main/**`, `src/preload/**`, `src/test/**`, `**/*.d.ts`, `**/*.test.{ts,tsx,js,jsx}`, `**/*.node.test.{ts,tsx,js,jsx}`\n- Kept thresholds unchanged:\n  - `statements: 80`\n  - `branches: 70`\n  - `functions: 80`\n  - `lines: 80`\n\n### Deterministic command-path alignment (local + CI)\n- Local command path used: `pnpm run test --coverage`\n- CI workflow command path: `.github/workflows/ci-quality-gates.yml` line 36 -> `run: pnpm run test --coverage`\n- Script resolution in `package.json`:\n  - `\"test\": \"vitest run\"`\n  - therefore `pnpm run test --coverage` resolves to `vitest run --coverage` in both local and CI.\n\n### Fresh verification evidence\nCommand run:\n- `pnpm run test --coverage`\n\nResult (fresh run):\n- Exit code: `1` (expected for current failing thresholds)\n- Tests: `13 passed`, `35 passed`\n- Global coverage totals:\n  - Statements: `75.67%`\n  - Branches: `72.30%`\n  - Functions: `83.07%`\n  - Lines: `75.67%`\n- Threshold enforcement remains active and unchanged:\n  - `ERROR: Coverage for lines (75.67%) does not meet global threshold (80%)`\n  - `ERROR: Coverage for statements (75.67%) does not meet global threshold (80%)`\n\n### Artifact cleanup confirmation\nCoverage artifacts removed after verification:\n- Removed: `coverage/coverage-summary.json`\n- Removed: `coverage/` directory\n- Verified absent from working tree.\n\n### Files changed in this task\n- `vitest.config.ts`\n\n### Commands executed in this task\n- `pnpm run test --coverage`\n- `rg -n \"run: pnpm run test --coverage|\\\"test\\\"\\s*:\\s*\\\"vitest run\\\"\" .github/workflows/ci-quality-gates.yml package.json`\n- `/bin/rm -f coverage/coverage-summary.json`\n- `/bin/rmdir coverage`\n- `git diff -- vitest.config.ts`\n- `git status --short`\n\n## Verifier Checkpoint (2026-02-16)\n\nCheckpoint scope: Wave 1.6 Wave 2 Task 1 verification-only.\n\nResult summary:\n- `vitest.config.ts` thresholds are unchanged and enforced at `statements: 80`, `branches: 70`, `functions: 80`, `lines: 80` (lines 25-29).\n- Deterministic command path is aligned in working tree:\n  - `package.json` script is `\"test\": \"vitest run\"` (line 13).\n  - `.github/workflows/ci-quality-gates.yml` runs `pnpm run test --coverage` (line 36).\n- Executed `pnpm run test --coverage` locally; command exited `1` due threshold failures, confirming enforcement is active:\n  - `ERROR: Coverage for lines (75.67%) does not meet global threshold (80%)`\n  - `ERROR: Coverage for statements (75.67%) does not meet global threshold (80%)`\n- Post-run artifact hygiene verified:\n  - `coverage/coverage-summary.json` and `coverage/` were removed.\n  - `git status --short -- coverage coverage/coverage-summary.json` returned no entries.\n\nConsistency assessment:\n- Task note evidence remains internally coherent for scope/threshold/path intent.\n- Noted workspace state risk: `.github/` is currently untracked in this working tree, so CI-path alignment evidence is present in files but not yet anchored by a committed workflow file in this branch snapshot.","title":"Define enforceable coverage scope and command path"}
