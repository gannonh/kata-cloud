{"type":"snapshot","v":1,"date":"2026-02-17T01:14:57.820Z","author":{"id":"user","name":"User","type":"user"},"content":"# Clarify draft-apply behavior in spec panel UX\n\nMake it explicit in the UI when a draft has been generated but not yet applied, so users understand why spec markdown has not changed.\n\n## Scope\nIn scope: spec-panel/orchestrator UX messaging and status indicators around draft readiness/applied state.\nOut of scope: auto-apply behavior changes unless explicitly approved as follow-up.\n\n## Inputs\n- [Spec](intent://local/note/spec)\n- [Implement spec-draft synthesis from orchestrator runs](intent://local/task/5eda575f-6be5-4c03-a27f-ae1ca6b2b797)\n\n## Definition of Done\n- UI clearly distinguishes `draft generated` vs `draft applied` states.\n- User can see explicit guidance that spec markdown changes only after apply.\n- Applied state includes clear confirmation (timestamp or equivalent).\n\n## Verification\n- `pnpm run desktop:typecheck`\n- `pnpm test -- notes`\n- `pnpm test -- orchestrator`\n- Manual: run prompt, confirm draft-generated state, apply draft, confirm applied state\n\n## Summary (Turn 1)\nImplementing scoped UX clarification for orchestrator draft lifecycle in spec panel: make `draft generated` vs `draft applied` explicit, state that spec markdown updates only after apply, and preserve visible applied confirmation.\n\n## Acceptance Criteria\n- [ ] Draft-present UI explicitly indicates draft is generated but not yet applied.\n- [ ] UI guidance explicitly states spec markdown remains unchanged until apply action.\n- [ ] Successful apply state shows explicit confirmation signal (existing timestamp/message acceptable).\n- [ ] Required verification commands are run and results captured.\n\n## Subtasks\n- None.\n\n## References\n- `src/features/spec-panel/spec-note-panel.tsx`\n- `src/features/spec-panel/spec-note-panel.test.tsx`\n- `src/main.tsx` (status panel display only, if needed)\n\n## Learnings\n- Keep this task isolated from run-history persistence and failure-path logic to minimize merge conflicts.\n\n## Changes\n- Pending implementation edits.\n\n## Summary (Turn 2)\nCompleted scoped UX clarification in spec panel draft card. UI now explicitly shows `generated (not applied)` before apply, states that markdown updates only after apply, and shows a clearer applied confirmation including time.\n\n## Changes\n- `src/features/spec-panel/spec-note-panel.tsx`\n  - Added explicit draft lifecycle status copy in Orchestrator Draft card:\n    - `Draft status: generated (not applied).`\n    - `Draft status: applied.`\n  - Added user guidance copy: `Spec Markdown updates only after you click Apply Draft to Spec.` (visible while pending apply).\n  - Updated apply success message to include confirmation time: `Applied draft from run <id> at <local time>.`\n- `src/features/spec-panel/spec-note-panel.test.tsx`\n  - Added assertions for pending-draft status and explicit pre-apply markdown guidance.\n  - Added assertion for applied confirmation message including `at` timestamp text.\n\n## Verification Results\n- `pnpm run desktop:typecheck` -> PASS (exit 0).\n- `pnpm test -- notes` -> PASS.\n  - Evidence: `Test Files 17 passed (17)`, `Tests 52 passed (52)`.\n- `pnpm test -- orchestrator` -> PASS.\n  - Evidence: `Test Files 17 passed (17)`, `Tests 52 passed (52)`.\n- Observed non-blocking warning during tests: `ReactDOMTestUtils.act` deprecation warning in existing test setup.\n\n## DoD Mapping\n- `UI clearly distinguishes draft generated vs draft applied states.` -> PASS via explicit `Draft status: generated (not applied).` and `Draft status: applied.` state text in `src/features/spec-panel/spec-note-panel.tsx`.\n- `User can see explicit guidance that spec markdown changes only after apply.` -> PASS via explicit guidance sentence rendered while draft is pending apply.\n- `Applied state includes clear confirmation (timestamp or equivalent).` -> PASS via applied success message including confirmation time (`... at <local time>.`).\n\n## Residual Risks\n- Confirmation timestamp uses client-local `toLocaleString()` formatting, so exact visual format varies by locale/timezone.\n- Existing non-blocking `act` deprecation warnings remain in tests (unchanged by this task).\n\n## Verification Summary (Turn 3 - Verifier, 2026-02-17)\n\n### Verdict\n- **GO** (Confidence: **High**)\n\n### Severity-Ranked Findings\n- **P0:** None.\n- **P1:** None.\n- **P2:** None (non-blocking existing warning only: `ReactDOMTestUtils.act` deprecation during tests).\n\n### Acceptance Criteria Checklist\n- ✅ `UI clearly distinguishes draft generated vs draft applied states.`\n  - Evidence: `src/features/spec-panel/spec-note-panel.tsx:232` renders `Draft status: generated (not applied).` when pending and `Draft status: applied.` after apply.\n  - Verification: Static review + `pnpm test -- notes` PASS with assertions in `src/features/spec-panel/spec-note-panel.test.tsx:137` and `src/features/spec-panel/spec-note-panel.test.tsx:145`.\n\n- ✅ `User can see explicit guidance that spec markdown changes only after apply.`\n  - Evidence: `src/features/spec-panel/spec-note-panel.tsx:234` renders `Spec Markdown updates only after you click Apply Draft to Spec.` while draft is not applied.\n  - Verification: Static review + test assertion in `src/features/spec-panel/spec-note-panel.test.tsx:138`.\n\n- ✅ `Applied state includes clear confirmation (timestamp or equivalent).`\n  - Evidence: apply status message now includes time at `src/features/spec-panel/spec-note-panel.tsx:138` (`Applied draft from run ... at ...`).\n  - Verification: Static review + regex assertion for timestamped applied message in `src/features/spec-panel/spec-note-panel.test.tsx:145`.\n\n### Out-of-Scope Guard Check\n- ✅ No out-of-scope behavior changes observed.\n- Evidence: `git diff --name-only` shows only:\n  - `src/features/spec-panel/spec-note-panel.tsx`\n  - `src/features/spec-panel/spec-note-panel.test.tsx`\n- No edits found for provider/auth runtime, PR/browser/context-adapter work, or auto-apply behavior.\n\n### Commands Run\n- `pnpm run desktop:typecheck` → PASS\n- `pnpm test -- notes` → PASS\n- `pnpm test -- orchestrator` → PASS\n\n### Risk Notes\n- Applied confirmation timestamp uses locale-dependent formatting (`toLocaleString()`), so exact display format varies by user locale/timezone (non-blocking).","title":"Clarify draft-apply behavior in spec panel UX"}
