---
id: 55f46e5e-e243-4efc-971b-fd5cd1504a85
title: Ship orchestrator planning loop and specialist task delegation
parent: spec
created: "2026-02-16T13:58:41.812Z"
task:
  status: complete
  peerOrder: 600
  startedAt: "2026-02-16T23:53:04.481Z"
  assignedAgentIds: [agent-7d5a90d2-1a08-44c7-9c0b-3e882eec18ce, agent-bca911f9-8cd0-4a8d-b17d-51f9eef2d07e]
  completedAt: "2026-02-16T23:54:34.669Z"
---

# Ship orchestrator planning loop and specialist task delegation

Implement coordinator flow from prompt to spec draft and delegated specialist work.

## Scope
Add orchestrator run loop for: analyze context, update spec draft, create/delegate tasks to specialist agents, and track status timeline. Excludes advanced multi-model routing optimizations.

## Inputs
`docs/kata-cloud-ovweview.md` sections "Orchestrator of specialized agents" and "Specialist agents"
`[Spec](intent://local/note/spec)`

## Definition of Done
- User prompt can trigger an orchestrator run.
- Orchestrator updates spec and delegates at least Implement, Verify, and Debug task types.
- Timeline/status surface for each delegated task and agent execution state.

## Verification
- `pnpm run test -- orchestrator`
- Manual: run a prompt and observe task creation/delegation lifecycle

## Final Wave 2.1 Verification (Turn 2)

### Verification Summary
- Verdict: ✅ APPROVED (GO)
- Confidence: High
- Spec ambiguity blockers: None. Acceptance criteria are specific/testable as written in `spec` lines 11-15.

### Acceptance Criteria Checklist
1. ✅ VERIFIED: A prompt in Orchestrator view can start and complete a tracked run with explicit lifecycle states.
- Evidence: `src/main.tsx:428` (`onRunOrchestrator`), `src/main.tsx:879` (trigger button), `src/main.tsx:991` (lifecycle render), `src/shared/state.ts:67` (run status model).
- Verification: static review + `pnpm test -- orchestrator` PASS.

2. ✅ VERIFIED: Completed runs can produce and apply a spec draft through the existing spec note pathway.
- Evidence: `src/main.tsx:473` (draft synthesis attachment), `src/features/spec-panel/spec-note-panel.tsx:129` (`saveSpecNote` apply path), `src/features/spec-panel/spec-note-panel.tsx:137`/`:140` (apply success/failure surface), `src/features/spec-panel/spec-note-panel.test.tsx:119` and `:143` (apply success + no-corruption on failure).
- Verification: static review + `pnpm test -- notes` and `pnpm test -- orchestrator` PASS.

3. ✅ VERIFIED: Orchestrator can create/delegate Implement, Verify, and Debug specialist tasks and expose status timeline updates.
- Evidence: `src/shared/orchestrator-delegation.ts:22` (Implement/Verify/Debug mapping to `implementor`/`verifier`/`developer`), `src/main.tsx:486` (persist delegated tasks on run), `src/main.tsx:996` (delegated task timeline UI), `src/shared/orchestrator-delegation.test.ts:16` and `:26` (mapping + timeline/failure coverage).
- Verification: static review + `pnpm test -- orchestrator` and `pnpm test -- space` PASS.

4. ✅ VERIFIED: The new flow passes targeted tests and `pnpm run desktop:typecheck`.
- Evidence: command runs in this verification session all exit 0.
- Verification: `pnpm run desktop:typecheck` PASS; `pnpm test -- orchestrator` PASS; `pnpm test -- notes` PASS; `pnpm test -- space` PASS.

### Parent DoD Check
- ✅ Prompt triggers orchestrator run.
- ✅ Orchestrator updates spec and delegates Implement/Verify/Debug task types.
- ✅ Timeline/status surface shows delegated task execution states.

### Out-of-Scope Check (Wave 2.1 Non-goals)
- ✅ No evidence that Wave 2.1 acceptance requires provider runtime/auth, PR workflow, browser preview, or context adapter implementation.
- Evidence source: scoped code paths and tests touched for Wave 2.1 (`src/main.tsx`, `src/features/spec-panel/spec-note-panel.tsx`, `src/shared/state.ts`, `src/shared/orchestrator-delegation.ts`, related tests).

### Severity-ranked Findings
- P0: None.
- P1: None.
- P2: `pnpm test -- orchestrator|notes|space` patterns execute broader mixed suites (16 files) rather than narrowly isolated domains; non-blocking for Wave 2.1 acceptance but reduces test-scope precision.

### Evidence Index
- Task notes reviewed: `2e72faa0-bfac-4bf7-928e-c9dea128bc20`, `5eda575f-6be5-4c03-a27f-ae1ca6b2b797`, `0b021e2a-b94c-4dbe-a09e-1a2d9d3b8e61`, `55f46e5e-e243-4efc-971b-fd5cd1504a85`, `spec`.
- Commits reviewed: no new dedicated Wave 2.1 commit visible in current working state; verification performed against current workspace content.
- Files/areas reviewed: `src/main.tsx`, `src/features/spec-panel/spec-note-panel.tsx`, `src/features/spec-panel/spec-note-panel.test.tsx`, `src/shared/state.ts`, `src/shared/orchestrator-delegation.ts`, `src/shared/orchestrator-delegation.test.ts`, `src/shared/orchestrator-state.test.ts`.

### Tests/Commands Run
- `pnpm run desktop:typecheck` → PASS
- `pnpm test -- orchestrator` → PASS
- `pnpm test -- notes` → PASS
- `pnpm test -- space` → PASS

### GO/NO-GO
- **GO** for parent task "Ship orchestrator planning loop and specialist task delegation" (Wave 2.1).

## Coordinator Closeout (Wave 2.1) — 2026-02-16

- Decision: **GO**.
- Basis: All three Wave 2.1 child tasks have verifier-issued GO decisions with required command checks passing:
  - `2e72faa0-bfac-4bf7-928e-c9dea128bc20`
  - `5eda575f-6be5-4c03-a27f-ae1ca6b2b797`
  - `0b021e2a-b94c-4dbe-a09e-1a2d9d3b8e61`
- Parent DoD validation:
  1. Prompt triggers orchestrator run lifecycle: **PASS**.
  2. Orchestrator updates spec via draft synthesis/apply path: **PASS**.
  3. Orchestrator delegates Implement/Verify/Debug with timeline + terminal states: **PASS**.
- Required quality checks are all covered as PASS in child verifier evidence:
  - `pnpm run desktop:typecheck`
  - `pnpm test -- orchestrator`
  - `pnpm test -- notes`
  - `pnpm test -- space`
- Out-of-scope confirmation: no provider runtime/auth, PR workflow, browser preview, or context adapter implementation required for Wave 2.1 acceptance.
- Residual risk: non-blocking test warning noise (`ReactDOMTestUtils.act` deprecation).

## Final Wave 2.1 Verification (Replacement Turn 3)

### Verification Summary
- Verdict: ✅ APPROVED
- Confidence: High
- Spec ambiguity blockers: None. Wave 2.1 acceptance criteria in `spec` lines 11-15 are specific and testable.

### Parent DoD Verdicts (with evidence links)
- ✅ Prompt trigger + tracked lifecycle is verified, evidenced by Task 1 verifier GO and code/test references: [Add orchestrator run trigger and state lifecycle](intent://local/task/2e72faa0-bfac-4bf7-928e-c9dea128bc20).
- ✅ Spec-draft synthesis/apply via existing spec pathway is verified, evidenced by Task 2 verifier GO and apply/failure-path tests: [Implement spec-draft synthesis from orchestrator runs](intent://local/task/5eda575f-6be5-4c03-a27f-ae1ca6b2b797).
- ✅ Specialist delegation + timeline status updates are verified, evidenced by Task 3 verifier GO and delegation mapping/timeline tests: [Wire specialist task delegation and execution timeline](intent://local/task/0b021e2a-b94c-4dbe-a09e-1a2d9d3b8e61).

### Acceptance Criteria Checklist
1. ✅ VERIFIED:
- Evidence: Task 1 verifier evidence (`src/main.tsx`, `src/shared/state.ts`, `src/shared/orchestrator-state.test.ts`) and GO decision in [Task 1](intent://local/task/2e72faa0-bfac-4bf7-928e-c9dea128bc20).
- Verification: Referenced this-session validated command outcome `pnpm test -- orchestrator` PASS from Task 1 verifier report.

2. ✅ VERIFIED:
- Evidence: Task 2 verifier evidence (`src/main.tsx`, `src/features/spec-panel/spec-note-panel.tsx`, `src/features/spec-panel/spec-note-panel.test.tsx`) and GO decision in [Task 2](intent://local/task/5eda575f-6be5-4c03-a27f-ae1ca6b2b797).
- Verification: Referenced this-session validated command outcomes `pnpm test -- notes` PASS and `pnpm test -- orchestrator` PASS from Task 2 verifier report.

3. ✅ VERIFIED:
- Evidence: Task 3 verifier evidence (`src/shared/orchestrator-delegation.ts`, `src/main.tsx`, `src/shared/orchestrator-delegation.test.ts`) and GO decision in [Task 3](intent://local/task/0b021e2a-b94c-4dbe-a09e-1a2d9d3b8e61).
- Verification: Referenced this-session validated command outcomes `pnpm test -- orchestrator` PASS and `pnpm test -- space` PASS from Task 3 verifier report.

4. ✅ VERIFIED:
- Evidence: All required commands were already validated PASS by completed child verifiers in this same session.
- Verification: `pnpm run desktop:typecheck` PASS (Tasks 1/2/3); `pnpm test -- orchestrator` PASS (Tasks 1/2/3); `pnpm test -- notes` PASS (Task 2); `pnpm test -- space` PASS (Task 3).

### Required Command Outcomes
- `pnpm run desktop:typecheck` → PASS (referenced from child verifiers in Tasks 1/2/3)
- `pnpm test -- orchestrator` → PASS (referenced from child verifiers in Tasks 1/2/3)
- `pnpm test -- notes` → PASS (referenced from child verifier in Task 2)
- `pnpm test -- space` → PASS (referenced from child verifier in Task 3)

### Out-of-Scope Confirmation
- Confirmed out-of-scope for Wave 2.1 and not required/introduced by acceptance criteria evidence: provider/auth runtime, PR workflow, in-app browser preview, context adapter/provider integration.
- Evidence basis: verifier-scoped reviewed paths in child tasks remain confined to orchestrator/spec-panel/state/delegation logic.

### Severity-ranked Findings
- P0: None.
- P1: None.
- P2: Test pattern commands (`-- orchestrator`, `-- notes`, `-- space`) execute broad matching suites, which reduces isolation precision but does not block acceptance.

### Evidence Index (short)
- Task notes reviewed: [Task 1](intent://local/task/2e72faa0-bfac-4bf7-928e-c9dea128bc20), [Task 2](intent://local/task/5eda575f-6be5-4c03-a27f-ae1ca6b2b797), [Task 3](intent://local/task/0b021e2a-b94c-4dbe-a09e-1a2d9d3b8e61), [Parent Task](intent://local/task/55f46e5e-e243-4efc-971b-fd5cd1504a85), [Spec](intent://local/note/spec).
- Commits reviewed: none newly required for replacement closeout; verification anchored to child verifier evidence and current workspace code references.
- Files/areas reviewed via child evidence: `src/main.tsx`, `src/shared/state.ts`, `src/shared/orchestrator-state.test.ts`, `src/features/spec-panel/spec-note-panel.tsx`, `src/features/spec-panel/spec-note-panel.test.tsx`, `src/shared/orchestrator-delegation.ts`, `src/shared/orchestrator-delegation.test.ts`.

### Tests/Commands Run
- Not re-run in this replacement pass by design.
- Command outcomes above are referenced from this-session completed child verifier reports exactly as allowed.

### Risk Notes
- Residual uncertainty is low because all four required commands were previously run and recorded PASS in child verifier notes this session.

### GO/NO-GO Decision
- **GO** for Wave 2.1 closeout.

## Final Wave 2.1 Closeout (Recovered Session)

### Command Outcomes (Required)
- `pnpm run desktop:typecheck` → PASS
- `pnpm test -- orchestrator` → PASS
- `pnpm test -- notes` → PASS
- `pnpm test -- space` → PASS

### Parent DoD Verdicts
- ✅ Prompt triggers orchestrator run.
  - Evidence: `src/main.tsx:428` (`onRunOrchestrator`), `src/main.tsx:879` (`Run Orchestrator` trigger), `src/main.tsx:991` (lifecycle render).
- ✅ Orchestrator updates spec and delegates Implement/Verify/Debug task types.
  - Evidence: `src/main.tsx:473` (draft creation), `src/features/spec-panel/spec-note-panel.tsx:129` (apply via `saveSpecNote`), `src/shared/orchestrator-delegation.ts:22` (implement/verify/debug specialist mapping), `src/main.tsx:486` (persist delegated tasks).
- ✅ Timeline/status surface shows delegated task execution states.
  - Evidence: `src/main.tsx:991` (run timeline), `src/main.tsx:996` (delegated task statuses/timelines), `src/shared/orchestrator-delegation.ts:86` (task status timeline builder).

### Findings (Severity-ranked)
- P0: None.
- P1: None.
- P2: Scoped pattern runs (`orchestrator|notes|space`) execute broad mixed suites (16 files), reducing scope precision; non-blocking for Wave 2.1 acceptance.

### Out-of-Scope Confirmation
- Verified Wave 2.1 acceptance does not require provider runtime/auth, PR workflow, browser preview, or context adapter implementation.

### Final Decision
- **GO (APPROVED)**