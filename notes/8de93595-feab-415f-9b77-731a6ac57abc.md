---
id: 8de93595-feab-415f-9b77-731a6ac57abc
title: Add repository guardrails to prevent artifact contamination
parent: spec
created: "2026-02-17T01:48:46.494Z"
task:
  status: complete
  peerOrder: 200
  startedAt: "2026-02-17T01:50:02.765Z"
  assignedAgentIds: [agent-c6a33793-78d8-4074-9e40-683c2fcc4bd7]
  completedAt: "2026-02-17T02:03:03.220Z"
---

# Add repository guardrails to prevent artifact contamination

Prevent recurrence of large transient artifacts and metadata pollution that destabilize branch/push workflows.

## Scope
In scope: ignore/validation guardrails for `.pnpm-store`, caches, binaries, and `.DS_Store`; lightweight policy automation in repo scripts/config.
Out of scope: CI platform redesign, package manager migration.

## Inputs
- [Spec](intent://local/note/spec)
- Current tracked hygiene signals and prior Wave 1.3 context.

## Definition of Done
- Guardrails block or flag forbidden artifact classes before commit.
- Repository ignore/validation rules explicitly cover nested `.DS_Store` and transient cache patterns.
- Changes are minimal, auditable, and documented in task note output.

## Verification
- `pnpm run desktop:typecheck`
- `pnpm test -- space`
- `git status --short --branch`
- Dry-run guardrail command on clean tree and on a simulated forbidden file path.

## Progress Update (Blocked Pending Guidance)

Summary: Implemented minimal guardrails for artifact hygiene, then stopped when `git status` showed an unexpected `AGENTS.md` modification not made by this agent.

Acceptance Criteria Status:
- ✅ Guardrails flag forbidden artifact classes (`scripts/repo-guardrails.mjs`).
- ✅ Ignore rules now explicitly cover nested `.DS_Store` and cache patterns (`.gitignore`).
- ⚠️ Final completion blocked pending guidance on unexpected `AGENTS.md` modification.

Files touched by this task:
- `.gitignore`
- `package.json`
- `scripts/repo-guardrails.mjs` (new)

Verification run:
- `pnpm run repo:guardrails -- --dry-run` -> PASS (`no forbidden artifact paths found`)
- `pnpm run repo:guardrails -- --dry-run --path=.pnpm-store/v3/files/simulated-index --path=tmp/.DS_Store` -> DRY-RUN flagged expected violations and exited 0
- `pnpm run desktop:typecheck` -> PASS
- `pnpm test -- space` -> PASS (all tests passed; existing non-blocking React act deprecation warning observed)
- `git status --short --branch` -> showed expected task changes plus unexpected `M AGENTS.md`

Blocking issue:
- Unexpected workspace change detected: `AGENTS.md` modified externally during task execution. Per repo instruction, work is paused awaiting coordinator/user direction.

## Completion Update

Scope-complete implementation for repository artifact guardrails.

What changed:
- `.gitignore`: expanded ignore coverage for nested metadata/cache/artifact paths:
  - `.DS_Store` and `**/.DS_Store`
  - `.pnpm-store/` and `**/.pnpm-store/`
  - `.electron-cache/` and `**/.electron-cache/`
  - `.cache/`, `coverage/`, `*.tsbuildinfo`
- `scripts/repo-guardrails.mjs` (new): lightweight guardrail checker that scans tracked/staged paths and flags forbidden artifact classes (`.DS_Store`, `.pnpm-store`, `.electron-cache`, `.cache`, `coverage`, `*.tsbuildinfo`).
  - Supports `--dry-run` so simulated violations can be demonstrated without failing CI/local flow.
  - Supports repeated `--path=<value>` inputs for dry-run simulation evidence.
- `package.json`: added `repo:guardrails` script (`node scripts/repo-guardrails.mjs`).

Verification evidence (re-run after recovery):
- `pnpm run repo:guardrails -- --dry-run`
  - PASS: `[repo-guardrails] PASS: no forbidden artifact paths found.`
- `pnpm run repo:guardrails -- --dry-run --path=.pnpm-store/v3/files/simulated-index --path=tmp/.DS_Store`
  - Expected dry-run detection output:
    - `.pnpm-store/v3/files/simulated-index (pnpm store cache)`
    - `tmp/.DS_Store (macOS metadata)`
  - Dry-run exits 0 with: `[repo-guardrails] DRY-RUN: exiting 0 for simulation mode.`
- `pnpm run desktop:typecheck`
  - PASS
- `pnpm test -- space`
  - PASS (`17` files, `52` tests)
  - Non-blocking known warning persisted: `ReactDOMTestUtils.act` deprecation
- `git status --short --branch`
  - `M .gitignore`
  - `M package.json`
  - `?? scripts/repo-guardrails.mjs`

Residual risk:
- This task adds repo-level guardrails and ignore rules only; it does not enforce server-side policy, which remains outside scope.

## Commit Evidence

Committed scoped guardrail changes:
- Commit: `fe3e028`
- Message: `Add repository guardrails for cache and DS_Store artifacts`
- Files in commit:
  - `.gitignore`
  - `package.json`
  - `scripts/repo-guardrails.mjs`

Post-commit status:
- `git status --short --branch` => clean working tree for this task; branch is ahead by one additional commit (`ahead 12`).