---
id: b9a5054a-0bfd-4eca-a825-7ba06f88e504
title: Normalize node-only tests in Vitest runs
parent: spec
created: "2026-02-16T15:34:02.471Z"
task:
  status: complete
  peerOrder: 200
  startedAt: "2026-02-16T15:58:47.229Z"
  assignedAgentIds: [agent-50915047-55ab-4beb-bf5e-773207b1119d]
  completedAt: "2026-02-16T16:08:07.758Z"
---

# Normalize node-only tests in Vitest runs

Prevent Node-only smoke test files from failing Vitest suite discovery during standard test commands.

## Scope
In scope: test runner configuration and/or test file naming/placement for `src/git/space-git-service.node.test.ts` and `src/git/types.node.test.ts`.
Out of scope: functional git lifecycle behavior changes.

## Inputs
[Spec](intent://local/note/spec)
Task note: [Re-run Wave 1 gate verification in network-enabled environment](intent://local/task/5c1f7d87-7581-42ed-bcce-83373e83f406)

## Definition of Done
- `pnpm run test -- space`, `pnpm run test -- git`, `pnpm run test -- notes`, and `pnpm run test -- task-parser` no longer fail due empty `.node.test.ts` suites.
- Node-specific smoke tests remain runnable via explicit Node command path or are migrated to valid Vitest suites.

## Verification
- `pnpm run test -- space`
- `pnpm run test -- git`
- `pnpm run test -- notes`
- `pnpm run test -- task-parser`

## Summary (Turn 1)
Reviewed scope and confirmed no expected overlap with the parallel git compile-fix task. Next step is a minimal Vitest/test-file adjustment so default scoped test commands stop failing on empty `.node.test.ts` suites while keeping node-only coverage runnable.

## Acceptance Criteria
- [x] `pnpm run test -- space` does not fail due to empty `.node.test.ts` suites.
- [x] `pnpm run test -- git` does not fail due to empty `.node.test.ts` suites.
- [x] `pnpm run test -- notes` does not fail due to empty `.node.test.ts` suites.
- [x] `pnpm run test -- task-parser` does not fail due to empty `.node.test.ts` suites.
- [x] `src/git/space-git-service.node.test.ts` and `src/git/types.node.test.ts` are migrated to valid Vitest suites.

## Subtasks
- None.

## References
- `src/git/space-git-service.node.test.ts`
- `src/git/types.node.test.ts`

## Learnings
- Initial status captured in Turn 1; detailed learnings recorded in Turn 2 below.

## Changes
- Initial status captured in Turn 1; exact file changes recorded in Turn 2 below.

## Summary (Turn 2)
Implemented a minimal test-only migration so Vitest recognizes the two `.node.test.ts` files as valid suites. Standard scoped test commands now pass without empty-suite failures.

## Learnings
- Running these files directly with `node --test` currently fails in this repo due ESM import resolution in `src/git/space-git-service.ts`; migrating them to Vitest suites is the reliable in-scope path.

## Changes
- `src/git/space-git-service.node.test.ts`: replaced `node:test` import with Vitest `test`, and normalized local imports to extensionless module paths.
- `src/git/types.node.test.ts`: replaced `node:test` import with Vitest `test`, and normalized local imports to extensionless module path.

## Verification Evidence
- `pnpm run test -- space` -> pass (`Test Files 13 passed`, `Tests 35 passed`).
- `pnpm run test -- git` -> pass (`Test Files 13 passed`, `Tests 35 passed`).
- `pnpm run test -- notes` -> pass (`Test Files 13 passed`, `Tests 35 passed`).
- `pnpm run test -- task-parser` -> pass (`Test Files 13 passed`, `Tests 35 passed`).

```ws-block:cli
{
  "id": "aa0a02d8-38b8-4a68-aa58-c3171380cc6a",
  "version": 1,
  "type": "cli",
  "createdAt": "2026-02-16T16:01:49.140Z",
  "createdBy": "agent",
  "command": "pnpm run test -- space",
  "description": "Verify space-scoped Vitest run",
  "cwd": "./",
  "display": {
    "showCommandPrefix": "$"
  }
}
```

```ws-block:cli
{
  "id": "7375afda-4240-48c6-ad6e-f128b3ffc772",
  "version": 1,
  "type": "cli",
  "createdAt": "2026-02-16T16:01:49.150Z",
  "createdBy": "agent",
  "command": "pnpm run test -- git",
  "description": "Verify git-scoped Vitest run",
  "cwd": "./",
  "display": {
    "showCommandPrefix": "$"
  }
}
```

```ws-block:cli
{
  "id": "d1bbc768-6332-4cea-be08-fc183db4fdd9",
  "version": 1,
  "type": "cli",
  "createdAt": "2026-02-16T16:01:49.159Z",
  "createdBy": "agent",
  "command": "pnpm run test -- notes",
  "description": "Verify notes-scoped Vitest run",
  "cwd": "./",
  "display": {
    "showCommandPrefix": "$"
  }
}
```

```ws-block:cli
{
  "id": "dcedc975-a584-4b5f-80ea-205e36ead308",
  "version": 1,
  "type": "cli",
  "createdAt": "2026-02-16T16:01:49.169Z",
  "createdBy": "agent",
  "command": "pnpm run test -- task-parser",
  "description": "Verify task-parser-scoped Vitest run",
  "cwd": "./",
  "display": {
    "showCommandPrefix": "$"
  }
}
```