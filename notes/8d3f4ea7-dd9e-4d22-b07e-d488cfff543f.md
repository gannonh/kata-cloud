---
id: 8d3f4ea7-dd9e-4d22-b07e-d488cfff543f
title: Bootstrap desktop shell and workspace state
parent: spec
created: "2026-02-16T13:58:41.787Z"
task:
  status: review_required
  peerOrder: 100
  assignedAgentIds: [agent-4b57afbc-e23c-4b3a-ab59-e71405b6133c]
  startedAt: "2026-02-16T14:10:42.998Z"
---

# Bootstrap desktop shell and workspace state

Create the baseline desktop app shell and shared state model needed by all subsequent features.

## Scope
Set up an Electron + TypeScript desktop app shell, UI layout regions (Explorer, Orchestrator, Spec), and baseline persisted application state contracts for spaces/sessions. Keep shell boundaries clean so a future Tauri migration remains feasible. Ownership includes Electron main/preload + shell/state interfaces and root toolchain stabilization, with renderer integration targeting the canonical React/Vite surface (`src/main.tsx`, `src/styles.css`, `index.html`). Excludes create-space CRUD/validation behavior, parser implementation in `packages/task-parser/**`, agent execution logic, and git lifecycle operations.

## Inputs
`docs/kata-cloud-ovweview.md`
`docs/kata-context.md`
`[Spec](intent://local/note/spec)`

## Definition of Done
- App launches into a three-panel layout matching the described workflow.
- Shared state can persist and restore at least one space/session record.
- Core navigation between Explorer, Orchestrator, Spec, and Changes views is wired.

## Verification
- `pnpm install`
- `pnpm run dev`
- Manual: restart app and confirm state restoration

## Execution Log

### Summary (Turn 1)
Scaffold a minimal Electron + TypeScript desktop shell from scratch in this repository, with a three-panel UI (Explorer, Orchestrator, Spec) and tabbed navigation including Changes. Add a shared app-state model with persisted spaces/sessions and restore it on launch, while keeping platform boundaries clean for future Tauri migration.

### Acceptance Criteria
- [ ] Electron + TypeScript app boots via `pnpm run dev` (verification blocked locally because dependency install cannot reach npm registry in this environment).
- [x] Default UI renders three-panel workflow layout: Explorer (left), Orchestrator (center), Spec (right).
- [x] Navigation between `Explorer`, `Orchestrator`, `Spec`, and `Changes` is wired and reflected in app state.
- [x] Shared state model includes spaces and sessions, persisted in local app data and rehydrated on relaunch.
- [x] Renderer accesses platform state through a narrow shell API boundary (no direct Node APIs in UI).

### Subtasks
- [ ] None (single-agent task)

### References
- `docs/kata-cloud-ovweview.md`
- `docs/kata-context.md`

### Learnings
- Repository state changed mid-task with concurrent agent updates; coordinator direction was added to the task note to use the React/Vite renderer as the canonical UI baseline.
- Keeping shell boundaries stable required moving layout/state wiring into `src/main.tsx` instead of maintaining a parallel renderer entry tree.

### Changes
- `src/main/index.ts`: Added Electron window bootstrap and IPC wiring, with dev-server loading in development and packaged file loading in production.
- `src/main/persisted-state-store.ts`: Added persisted JSON state store under Electron userData with normalization and fallback creation.
- `src/preload/index.ts`: Exposed narrow shell API (`getState`, `saveState`, `subscribeState`) over context bridge.
- `src/shared/state.ts`: Added shared `AppState` model for spaces/sessions/navigation plus default + normalization helpers.
- `src/shared/shell-api.ts`: Added typed IPC channel constants and renderer-facing shell interface.
- `src/main.tsx` and `src/styles.css`: Implemented three-panel shell UI, explorer/orchestrator/spec+changes navigation, and renderer state persistence wiring.
- `package.json`, `tsconfig.main.json`, `tsconfig.renderer.json`, `tsconfig.base.json`, `.gitignore`, `src/global.d.ts`, `index.html`: Added desktop toolchain scripts/config and typing support needed for the shell baseline.

## Coordinator Boundary Update

Prioritize establishing stable shell/layout and state integration points for downstream feature tasks. Minimize churn to app entry/layout contracts after initial scaffold so spec-panel and other wave tasks can integrate with small, low-conflict patches.

## Coordinator Conflict Policy

Bootstrap owns root scaffold and baseline toolchain files (`package.json`, `index.html`, `tsconfig*`, app entry/main/preload wiring). After initial scaffold lands, minimize churn in these files so Wave 1 feature tasks can integrate with low-conflict patches.

## Coordinator Architecture Direction

Canonical direction: use the emergent React/Vite renderer surface as the single renderer baseline. Do not maintain a parallel renderer tree if avoidable. Integrate Electron shell responsibilities into this baseline: main/preload process wiring, secure shell API, persisted state contracts, and app startup paths. Keep root toolchain/script ownership stable for all Wave 1 tasks.

### Summary (Turn 2)
Implemented the desktop shell baseline with Electron main/preload boundaries and a canonical React/Vite renderer layout. The app state model now tracks spaces/sessions + active navigation view and is persisted through main-process storage (with renderer fallback storage when shell API is unavailable).

### Verification Results
- `pnpm install` -> **failed** (`ENOTFOUND registry.npmjs.org`) in this execution environment.
- `pnpm run dev` -> **failed** because dependencies are not installed (`tsc: command not found` after install failure).
- Manual restart validation -> **not run** (blocked by inability to launch the app locally).

```ws-block:cli
{
  "id": "3e1b872f-7b46-4986-bbe3-9eaeced8db86",
  "version": 1,
  "type": "cli",
  "createdAt": "2026-02-16T14:27:24.734Z",
  "createdBy": "agent",
  "command": "pnpm install",
  "description": "Install project dependencies for desktop shell + renderer",
  "cwd": "./",
  "display": {
    "showCommandPrefix": "$"
  }
}
```

```ws-block:cli
{
  "id": "62fb9fed-6d1e-44c5-833b-03ed5f53e923",
  "version": 1,
  "type": "cli",
  "createdAt": "2026-02-16T14:27:24.744Z",
  "createdBy": "agent",
  "command": "pnpm run dev",
  "description": "Launch Vite + Electron shell and verify three-panel layout + persisted state restore",
  "cwd": "./",
  "display": {
    "showCommandPrefix": "$"
  }
}
```

### Summary (Turn 3)
Applied coordinator architecture direction by consolidating shell UI/state on the React/Vite renderer entry (`src/main.tsx`) and keeping Electron responsibilities in main/preload with shared typed contracts.

### Risks / Follow-ups
- Local verification remains blocked by network restrictions (`registry.npmjs.org` unreachable), so an environment with npm access is required to run `pnpm install`, launch the Electron shell, and perform restart persistence validation.
- Repository has high concurrent churn from parallel task agents; coordinator should resolve any final integration conflicts across root scaffold files (`package.json`, `tsconfig*`, app entry).

### Summary (Turn 4)
Recovered-session check completed. No additional code changes were made in this turn; task artifacts and status remain accurate (`review_required`) with verification still blocked by offline package registry access in this environment.

### Verification (Recovery Turn)
- Reconfirmed prior command outcomes remain unchanged:
  - `pnpm install` blocked by `ENOTFOUND registry.npmjs.org`
  - `pnpm run dev` blocked downstream due missing installed dependencies

### Summary (Turn 5)
Received coordinator approval confirming this task owns shell scaffold, base layout/navigation, and baseline persisted state contracts only. Revalidated current implementation is still within that scope with no additional feature creep.

### Verification (Coordinator Recheck)
- `pnpm install` -> **failed** (`ENOTFOUND registry.npmjs.org`).
- `pnpm run dev` -> **failed** because dependencies are unavailable (`tsc: command not found` downstream of install failure).
- Manual restart validation -> still blocked because app cannot launch without dependencies.

### Summary (Turn 6)
Handled high-priority cross-agent coordination request from task-parser implementor. Shared current Wave 1 scaffold path conventions, shell-owned file boundaries, and compatible test invocation guidance (`pnpm run test -- task-parser` / `pnpm run test -- packages/task-parser`) to avoid conflicts with shell/state ownership.

### Summary (Turn 7)
Handled high-priority coordination with space-metadata implementor. Confirmed bootstrap scope will remain minimal/generic (no create-space form/validation/schema specifics) and shared explicit bootstrap-owned file paths to prevent overlap. Reiterated additive-only contract changes for `src/shared/state.ts` with coordination required before edits.

### Summary (Turn 8)
Processed workspace event from parser agent completion. Confirmed parser implementation stayed isolated under `packages/task-parser/**` per agreed conventions, with no requested changes to bootstrap shell/state contracts. Forwarded this checkpoint to coordinator; no code changes required in this task turn.

### Summary (Turn 9)
Processed coordinator high-priority direction and revalidated conformance: canonical renderer remains `src/main.tsx` + root Vite surface, with Electron/main-preload/shell-state ownership in `src/main/*`, `src/preload/*`, and `src/shared/*`. No active package/tsconfig/main-process references to a parallel renderer tree were found.

### Summary (Turn 10)
Processed workspace event from space-metadata agent completion and performed overlap check. Observed cross-task edits in bootstrap-owned files (`src/main.tsx`, `src/styles.css`) plus additive shared-state coupling to git types (`src/shared/state.ts` optional `gitStatus`). No direct code edits made in this turn to avoid reverting another agentâ€™s completed task; escalated ownership reconciliation question to coordinator.

### Summary (Turn 11)
Processed coordinator gate update. No implementation changes made; bootstrap task remains stabilized in `review_required` to avoid further root-shell churn while space metadata and dependent git lifecycle tasks complete.

### Summary (Turn 12)
Processed coordinator freeze instruction from workspace event. No code or task-status changes made; bootstrap remains intentionally frozen at `review_required` unless a targeted fix is explicitly requested by coordinator.

### Summary (Turn 13)
Processed coordinator completion event. Verified this task is already marked `complete` and reflected as done in spec task list; no additional implementation or status edits were required.

### Summary (Turn 14)
Received coordinator high-priority directive to keep bootstrap at `review_required` and freeze further edits unless an explicit targeted fix is requested. Applied status alignment and made no implementation changes.

### Summary (Turn 15)
Processed coordinator event confirming spec-panel freeze enforcement to avoid parallel artifacts and integration churn. No bootstrap changes required; task remains frozen at `review_required` pending explicit targeted-fix request.

### Summary (Turn 16)
Processed coordinator decision to accept current cross-task additions as Wave 1 integration points (including renderer composition touches and optional `SpaceRecord.gitStatus` coupling). No cleanup/refactor performed; bootstrap remains frozen unless verifier requests targeted fixes.

### Summary (Turn 17)
Processed coordinator event confirming bootstrap remains frozen at `review_required`. No code changes were made; cleanup is deferred until space stabilization, git final wiring, and Wave 1 verifier findings determine whether a targeted bootstrap follow-up is necessary.