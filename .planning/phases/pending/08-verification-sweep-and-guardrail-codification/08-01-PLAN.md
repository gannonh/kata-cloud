---
phase: 08-verification-sweep-and-guardrail-codification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/shared/orchestrator-run-lifecycle.test.ts
  - src/shared/orchestrator-run-view-model.test.ts
  - src/main/persisted-state-store.node.test.ts
  - src/context/context-adapter.node.test.ts
  - docs/developer/testing.mdx
autonomous: true

must_haves:
  truths:
    - "Targeted automated guardrails cover normal, failure, and resume regression paths for orchestrator/context behavior"
    - "Developers can run one explicit command to validate orchestrator/context regression safety before merge"
    - "Guardrail coverage remains deterministic and aligned with existing lifecycle/context contracts"
  artifacts:
    - path: "package.json"
      provides: "Dedicated orchestrator/context regression script command"
    - path: "src/shared/orchestrator-run-lifecycle.test.ts"
      provides: "Deterministic normal/failure transition coverage"
    - path: "src/main/persisted-state-store.node.test.ts"
      provides: "Resume/interrupted recovery persistence assertions"
    - path: "src/context/context-adapter.node.test.ts"
      provides: "Context provider success/fallback/failure contract assertions"
  key_links:
    - from: "package.json"
      to: "src/shared/orchestrator-run-lifecycle.test.ts"
      via: "Focused script executes lifecycle regression tests"
      pattern: "test:orchestrator-context"
    - from: "package.json"
      to: "src/main/persisted-state-store.node.test.ts"
      via: "Focused script executes resume recovery tests"
      pattern: "test:orchestrator-context"
    - from: "package.json"
      to: "src/context/context-adapter.node.test.ts"
      via: "Focused script executes context adapter regression tests"
      pattern: "test:orchestrator-context"
---

<objective>
Codify a deterministic orchestrator/context guardrail suite for VERI-01.

Purpose: Ensure normal, failure, and resume behaviors are validated by a single focused automated test command.
Output: Updated regression tests, command wiring, and developer testing documentation.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/pending/08-verification-sweep-and-guardrail-codification/08-RESEARCH.md
@package.json
@src/shared/orchestrator-run-lifecycle.test.ts
@src/shared/orchestrator-run-view-model.test.ts
@src/main/persisted-state-store.node.test.ts
@src/context/context-adapter.node.test.ts
@docs/developer/testing.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Tighten orchestrator/context regression assertions for normal, failure, and resume paths</name>
  <files>
    src/shared/orchestrator-run-lifecycle.test.ts
    src/shared/orchestrator-run-view-model.test.ts
    src/main/persisted-state-store.node.test.ts
    src/context/context-adapter.node.test.ts
  </files>
  <action>
Audit and extend the existing tests so the focused guardrail suite explicitly covers all VERI-01 paths:
1. Normal flow: queued -> running -> completed with deterministic timeline and terminal metadata.
2. Failure flow: deterministic failed transitions and actionable failure/diagnostic retention in projection helpers.
3. Resume flow: persisted queued/running runs recover as interrupted after initialization and stay stable after disk round-trip.
4. Context contract flow: provider success, typed failure, fallback behavior, and provider provenance compatibility.

Keep assertions deterministic and state-driven. Reuse existing helper patterns and avoid brittle UI-dependent test logic in these unit/node tests.
  </action>
  <verify>
    `pnpm test -- src/shared/orchestrator-run-lifecycle.test.ts src/shared/orchestrator-run-view-model.test.ts src/main/persisted-state-store.node.test.ts src/context/context-adapter.node.test.ts` passes.
  </verify>
  <done>
    Test files explicitly encode normal/failure/resume/context regression coverage with deterministic assertions and no flaky timing dependencies.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add a single focused orchestrator/context guardrail command</name>
  <files>
    package.json
    docs/developer/testing.mdx
  </files>
  <action>
Add a dedicated script in `package.json` (for example `test:orchestrator-context`) that runs the curated orchestrator/context regression file set from Task 1.

Update `docs/developer/testing.mdx` with:
- command purpose,
- exact command usage,
- when to run it (pre-PR guardrail and Phase verification flow).

Do not introduce new runners or wrapper tooling. Keep execution on native Vitest commands.
  </action>
  <verify>
    `pnpm run test:orchestrator-context` passes.
    `pnpm run desktop:typecheck` passes.
  </verify>
  <done>
    A single documented command runs orchestrator/context guardrails and succeeds locally.
  </done>
</task>

</tasks>

<verification>
- Focused regression command passes.
- Full project typecheck remains green.
- Guardrail command and docs are consistent with actual test files.
</verification>

<success_criteria>
- VERI-01 normal/failure/resume coverage is explicitly represented in a targeted automated suite.
- `package.json` exposes a deterministic command to run that suite.
- Testing docs describe and align with the new guardrail command.
</success_criteria>

<output>
After completion, create `.planning/phases/pending/08-verification-sweep-and-guardrail-codification/08-01-SUMMARY.md`
</output>

