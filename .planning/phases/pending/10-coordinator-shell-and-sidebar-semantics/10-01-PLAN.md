---
phase: 10-coordinator-shell-and-sidebar-semantics
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/features/coordinator-shell/types.ts
  - src/features/coordinator-shell/view-model.ts
  - src/features/coordinator-shell/view-model.test.ts
  - src/features/coordinator-shell/ui-state.ts
  - src/features/coordinator-shell/ui-state.test.ts
autonomous: true

must_haves:
  truths:
    - "Coordinator shell derives deterministic sidebar, chat, and workflow data from persisted session and run records."
    - "Transient shell interactions (panel collapse, section expansion, tab focus) are modeled locally without mutating persisted AppState contracts."
    - "Projection output preserves agent/task/status metadata required for UX-04 and downstream chat rendering."
  artifacts:
    - path: "src/features/coordinator-shell/view-model.ts"
      provides: "Pure projection from app/run/spec state to coordinator shell view model"
    - path: "src/features/coordinator-shell/ui-state.ts"
      provides: "Reducer for transient coordinator shell interaction state"
    - path: "src/features/coordinator-shell/types.ts"
      provides: "Typed contracts for sidebar sections, chat entries, workflow steps, and shell UI state"
  key_links:
    - from: "src/features/coordinator-shell/view-model.ts"
      to: "src/shared/orchestrator-run-view-model.ts"
      via: "Coordinator projection consumes run diagnostics and delegated task status projections"
      pattern: "projectOrchestratorRunViewModel"
    - from: "src/features/coordinator-shell/ui-state.ts"
      to: "src/main.tsx"
      via: "Reducer-managed shell UI state drives coordinator layout interaction semantics"
      pattern: "useReducer"
---

<objective>
Create coordinator-shell projection and UI-state foundations.

Purpose: Establish typed, testable semantics for Phase 10 shell behavior before renderer rewiring.
Output: New coordinator-shell types, view-model projector, reducer state machine, and focused unit tests.
</objective>

<execution_context>
<!-- Executor agent has built-in instructions for plan execution and summary creation -->
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/pending/10-coordinator-shell-and-sidebar-semantics/10-CONTEXT.md
@.planning/phases/pending/10-coordinator-shell-and-sidebar-semantics/10-RESEARCH.md
@src/main.tsx
@src/shared/state.ts
@src/shared/orchestrator-run-view-model.ts
@src/features/spec-panel/types.ts
</context>

<spec_refs>
- docs/design/specs/02-coordinator-session.md (primary shell/layout/chat semantics)
- docs/design/specs/04-build-session.md (sidebar and workflow structure)
- docs/design/specs/06-wave-execution.md (agent/task status semantics)
</spec_refs>

<tasks>

<task type="auto">
  <name>Task 1: Define coordinator shell contracts and projection input boundaries</name>
  <files>
    src/features/coordinator-shell/types.ts
    src/features/coordinator-shell/view-model.ts
  </files>
  <action>
Create a dedicated coordinator-shell domain contract for sidebar rows, chat entries, context chips, and workflow steps. Define projection inputs explicitly from existing persisted structures (`AppState`, run view models, spec-note task state) so Phase 10 renderer wiring remains additive and does not fork core state contracts.
  </action>
  <verify>
    `pnpm run desktop:typecheck`
  </verify>
  <done>
    Coordinator-shell contracts are typed, importable, and aligned to UX-01/UX-04 semantics without changing preload/main IPC APIs.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement deterministic projection for sidebar, chat, and workflow semantics</name>
  <files>
    src/features/coordinator-shell/view-model.ts
    src/features/coordinator-shell/view-model.test.ts
  </files>
  <action>
Implement pure projection helpers that convert active session/run/spec data into coordinator-shell view state: status-aware agent/sidebar groupings, chronological chat entries with role/timestamp metadata, and workflow-step status for Creating Spec/Implement/Accept changes. Cover edge cases for no runs, failed runs, interrupted runs, and empty draft/spec states.
  </action>
  <verify>
    `pnpm test -- src/features/coordinator-shell/view-model.test.ts`
  </verify>
  <done>
    Projection tests prove deterministic outputs for success/failure/no-data states and include explicit assertions for agent/task status visibility.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add reducer-driven transient shell UI state with focused tests</name>
  <files>
    src/features/coordinator-shell/ui-state.ts
    src/features/coordinator-shell/ui-state.test.ts
  </files>
  <action>
Create reducer logic for transient coordinator-shell interactions: sidebar section expand/collapse, right-panel collapse toggle, active center tab selection, and message expansion state. Keep this state session-local and avoid persisting purely visual toggles into `AppState` to preserve migration safety.
  </action>
  <verify>
    `pnpm test -- src/features/coordinator-shell/ui-state.test.ts`
  </verify>
  <done>
    UI-state transitions are deterministic and tested, with no regressions to persisted state normalization contracts.
  </done>
</task>

</tasks>

<verification>
1. `pnpm test -- src/features/coordinator-shell/view-model.test.ts src/features/coordinator-shell/ui-state.test.ts`
2. `pnpm run desktop:typecheck`
</verification>

<success_criteria>
- Phase 10 has a dedicated coordinator-shell projection layer independent from monolithic inline rendering.
- Transient shell interaction behavior is reducer-driven and test-covered.
- Foundations satisfy UX-04 data-shaping prerequisites for sidebar/chat/workflow rendering.
</success_criteria>

<output>
After completion, create `.planning/phases/pending/10-coordinator-shell-and-sidebar-semantics/10-01-SUMMARY.md`
</output>
